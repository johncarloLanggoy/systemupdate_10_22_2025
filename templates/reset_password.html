<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - Leshley's Eatery</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="{{ url_for('static', filename='auth.css') }}">
</head>
<body>
    <div class="modal show" style="display: flex;">
        <div class="modal-content">
            <span class="close" id="closeBtn">&times;</span>
            
            <div class="auth-box active">
                <h2>Reset Password</h2>
                
                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="auth-message {% if category == 'error' %}message-error{% else %}message-success{% endif %}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                
                <form method="POST" id="resetPasswordForm">
                    <div class="password-wrapper">
                        <input type="password" name="password" id="newPassword" placeholder="New Password" required>
                        <i class="bx bx-show eye-icon" id="toggleNewPassword"></i>
                    </div>
                    
                    <div class="password-wrapper">
                        <input type="password" name="confirm_password" id="confirmNewPassword" placeholder="Confirm New Password" required>
                        <i class="bx bx-show eye-icon" id="toggleConfirmNewPassword"></i>
                    </div>
                    
                    <div class="password-strength hidden" id="passwordStrength">
                        <div class="strength-bar">
                            <div class="strength-fill" id="strengthFill"></div>
                        </div>
                        <small class="strength-text" id="strengthText">Password strength</small>
                    </div>
                    
                    <button type="submit" id="resetSubmit">Reset Password</button>
                </form>
                
                <p>
                    <a href="{{ url_for('auth') }}" style="color: #ffb347; text-decoration: none;">
                        ← Back to Login
                    </a>
                </p>
            </div>
        </div>
    </div>

    <script>
        // Close button functionality
        document.getElementById('closeBtn').addEventListener('click', function() {
            window.location.href = "{{ url_for('auth') }}";
        });

        // Password toggle functionality
        document.getElementById('toggleNewPassword')?.addEventListener('click', function() {
            const input = document.getElementById('newPassword');
            const icon = this;
            if (input.type === "password") {
                input.type = "text";
                icon.classList.replace('bx-show', 'bx-hide');
            } else {
                input.type = "password";
                icon.classList.replace('bx-hide', 'bx-show');
            }
        });

        document.getElementById('toggleConfirmNewPassword')?.addEventListener('click', function() {
            const input = document.getElementById('confirmNewPassword');
            const icon = this;
            if (input.type === "password") {
                input.type = "text";
                icon.classList.replace('bx-show', 'bx-hide');
            } else {
                input.type = "password";
                icon.classList.replace('bx-hide', 'bx-show');
            }
        });

        // Password strength checker
        function checkPasswordStrength(password) {
            const requirements = {
                length: password.length >= 8,
                lowercase: /[a-z]/.test(password),
                uppercase: /[A-Z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)
            };
            
            const allRequirementsMet = Object.values(requirements).every(Boolean);
            return { allRequirementsMet, requirements };
        }

        function updatePasswordStrength(password) {
            const strengthBar = document.getElementById('strengthFill');
            const strengthText = document.getElementById('strengthText');
            const passwordStrength = document.getElementById('passwordStrength');
            const resetSubmit = document.getElementById('resetSubmit');
            
            if (!password) {
                passwordStrength.classList.add('hidden');
                if (resetSubmit) resetSubmit.disabled = false;
                return;
            }
            
            passwordStrength.classList.remove('hidden');
            
            const { allRequirementsMet } = checkPasswordStrength(password);
            
            if (allRequirementsMet) {
                strengthBar.style.width = '100%';
                strengthBar.style.background = '#4CAF50';
                strengthText.textContent = 'Strong password!';
                if (resetSubmit) resetSubmit.disabled = false;
            } else {
                strengthBar.style.width = '25%';
                strengthBar.style.background = '#ff4444';
                strengthText.textContent = '❌ Password does not meet requirements';
                if (resetSubmit) resetSubmit.disabled = true;
            }
        }

        // Real-time password strength checking
        document.getElementById('newPassword')?.addEventListener('input', function() {
            updatePasswordStrength(this.value);
            checkPasswordMatch();
        });

        document.getElementById('confirmNewPassword')?.addEventListener('input', function() {
            checkPasswordMatch();
        });

        // Password match validation
        function checkPasswordMatch() {
            const password = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;
            const confirmInput = document.getElementById('confirmNewPassword');
            
            if (confirmPassword === '') {
                confirmInput.classList.remove('password-match', 'password-mismatch');
                return;
            }
            
            if (password === confirmPassword) {
                confirmInput.classList.add('password-match');
                confirmInput.classList.remove('password-mismatch');
            } else {
                confirmInput.classList.add('password-mismatch');
                confirmInput.classList.remove('password-match');
            }
        }

        // Auto-hide flash messages after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            const flashMessages = document.querySelectorAll('.auth-message');
            flashMessages.forEach(message => {
                if (!message.classList.contains('message-error')) {
                    setTimeout(() => {
                        message.style.display = 'none';
                    }, 5000);
                }
            });
        });
    </script>
</body>
</html>